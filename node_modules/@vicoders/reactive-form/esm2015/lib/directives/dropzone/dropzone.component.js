/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/dropzone/dropzone.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, forwardRef, ElementRef, ViewChild, Injector } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import * as _ from 'lodash';
import { DropzoneComponent, DropzoneDirective } from 'ngx-dropzone-wrapper';
export class CustomDropzoneComponent {
    /**
     * @param {?} element
     * @param {?} injector
     */
    constructor(element, injector) {
        this.element = element;
        this.injector = injector;
        this.fileList = [];
        this.config = {
            addRemoveLinks: true
        };
        this.onChange = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => { });
        this.onTouched = (/**
         * @return {?}
         */
        () => { });
        this.disabled = false;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    writeValue(val) {
        if (val) {
            this.value = val;
        }
    }
    /**
     * @return {?}
     */
    get value() {
        return this._value;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set value(val) {
        this._value = val;
        this.onChange(this._value);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const UPLOAD_DIRECTIVE_HEADERS = this.injector.get('UPLOAD_DIRECTIVE_HEADERS');
        /** @type {?} */
        const UPLOAD_DIRECTIVE_API_URL = this.injector.get('UPLOAD_DIRECTIVE_API_URL');
        /** @type {?} */
        const $this = this;
        if (this.maxFiles !== 1 && !_.isEmpty($this.oldValue)) {
            _.forEach(this.oldValue, (/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                $this.fileList.push(value);
                $this.value = $this.fileList;
            }));
        }
        if (this.maxFiles === 1 && !_.isEmpty($this.oldValue)) {
            $this.value = $this.oldValue;
        }
        this.config.params = {
            upload_path: this.upload_path
        };
        this.config.url = UPLOAD_DIRECTIVE_API_URL + this.url;
        this.config.headers = UPLOAD_DIRECTIVE_HEADERS;
        this.config.acceptedFiles = this.acceptedFiles;
        this.config.maxFilesize = this.maxFilesize;
        this.config.maxFiles = this.maxFiles;
        this.config.paramName = this.paramName;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onUploadError($event) {
        // AppInjector.get(NotificationService).show('warning', $event[1], 5000);
        console.log('warning', $event);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onUploadSuccess($event) {
        if (this.maxFiles !== 1) {
            this.fileList.push(this.resultTransformer($event[1]));
            this.value = this.fileList;
        }
        else {
            this.value = this.resultTransformer($event[1]);
        }
    }
    /**
     * @return {?}
     */
    onReset() {
        if (this.componentRef && this.componentRef.directiveRef) {
            this.componentRef.directiveRef.reset();
            this.fileList = [];
            this.value = this.fileList;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onFileRemoved($event) {
        /** @type {?} */
        const obj = JSON.parse($event.xhr.response);
        if (this.maxFiles !== 1) {
            this.fileList.splice(this.fileList.indexOf(this.resultTransformer(obj), 1));
            this.value = this.fileList;
        }
        else {
            this.value = null;
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    deleteItem(item) {
        this.fileList.splice(this.fileList.indexOf(item), 1);
        this.value = this.fileList;
    }
}
CustomDropzoneComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'custom-dropzone',
                template: "<dropzone (removedFile)=\"onFileRemoved($event)\" [config]=\"config\" [message]=\"message\" (error)=\"onUploadError($event)\" (success)=\"onUploadSuccess($event)\"></dropzone>\n\n<div class=\"preview-frame\" *ngIf=\"showPreview\">\n    <p>Descriptive images of the product</p>\n    <div *ngIf=\"maxFiles !== 1\">\n        <span class=\"group-item\" *ngFor=\"let item of value\">\n            <img class=\"singleImg\" width=\"120\" height=\"120\" [src]=\"item\" alt=\"\">\n            <span (click)=\"deleteItem(item)\">Remove File</span>\n        </span>\n    </div>\n    <div *ngIf=\"maxFiles == 1\">\n        <img class=\"singleImg\" width=\"120\" height=\"120\" [src]=\"value\" alt=\"\">\n    </div>\n</div>\n\n<div class=\"btn-reset\">\n    <a class=\"btn btn-primary\" (click)=onReset()>Reset</a>\n</div>\n",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => CustomDropzoneComponent)),
                        multi: true
                    }
                ],
                styles: [".singleImg{border:1px solid #000;padding:3px;margin-right:5px}.preview-frame{padding:8px}.preview-frame .group-item{position:relative}.preview-frame .group-item span{position:absolute;top:73px;left:18px;cursor:pointer}p{padding:8px 16px;text-align:center;border:2px dashed;color:#666;font-size:14px;letter-spacing:1px;background:#dcdcdc}.btn-reset{text-align:right}.btn-reset a{margin:8px;color:#fff}"]
            }] }
];
/** @nocollapse */
CustomDropzoneComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Injector }
];
CustomDropzoneComponent.propDecorators = {
    message: [{ type: Input }],
    upload_path: [{ type: Input }],
    acceptedFiles: [{ type: Input }],
    maxFilesize: [{ type: Input }],
    maxFiles: [{ type: Input }],
    showPreview: [{ type: Input }],
    oldValue: [{ type: Input }],
    url: [{ type: Input }],
    headers: [{ type: Input }],
    paramName: [{ type: Input }],
    _value: [{ type: Input }],
    resultTransformer: [{ type: Input }],
    componentRef: [{ type: ViewChild, args: [DropzoneComponent,] }],
    directiveRef: [{ type: ViewChild, args: [DropzoneDirective,] }]
};
if (false) {
    /** @type {?} */
    CustomDropzoneComponent.prototype.message;
    /** @type {?} */
    CustomDropzoneComponent.prototype.upload_path;
    /** @type {?} */
    CustomDropzoneComponent.prototype.acceptedFiles;
    /** @type {?} */
    CustomDropzoneComponent.prototype.maxFilesize;
    /** @type {?} */
    CustomDropzoneComponent.prototype.maxFiles;
    /** @type {?} */
    CustomDropzoneComponent.prototype.showPreview;
    /** @type {?} */
    CustomDropzoneComponent.prototype.oldValue;
    /** @type {?} */
    CustomDropzoneComponent.prototype.url;
    /** @type {?} */
    CustomDropzoneComponent.prototype.headers;
    /** @type {?} */
    CustomDropzoneComponent.prototype.paramName;
    /** @type {?} */
    CustomDropzoneComponent.prototype._value;
    /** @type {?} */
    CustomDropzoneComponent.prototype.resultTransformer;
    /** @type {?} */
    CustomDropzoneComponent.prototype.fileList;
    /** @type {?} */
    CustomDropzoneComponent.prototype.config;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.disabled;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.onChange;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.onTouched;
    /** @type {?} */
    CustomDropzoneComponent.prototype.componentRef;
    /** @type {?} */
    CustomDropzoneComponent.prototype.directiveRef;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.element;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHpvbmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZpY29kZXJzL3JlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9kcm9wem9uZS9kcm9wem9uZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUcsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxpQkFBaUIsRUFBMkIsTUFBTSxzQkFBc0IsQ0FBQztBQWtCckcsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7SUF1Q2xDLFlBQW9CLE9BQW1CLEVBQVUsUUFBa0I7UUFBL0MsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFibkUsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUVkLFdBQU0sR0FBUTtZQUNaLGNBQWMsRUFBRSxJQUFJO1NBQ3JCLENBQUM7UUFVQSxJQUFJLENBQUMsUUFBUTs7OztRQUFHLENBQUMsR0FBUSxFQUFFLEVBQUUsR0FBRSxDQUFDLENBQUEsQ0FBQztRQUNqQyxJQUFJLENBQUMsU0FBUzs7O1FBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFBLENBQUM7UUFDMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQzs7Ozs7SUFDRCxVQUFVLENBQUMsR0FBUTtRQUNqQixJQUFJLEdBQUcsRUFBRTtZQUNQLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1NBQ2xCO0lBQ0gsQ0FBQzs7OztJQUVELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLE1BQU0s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LEVBQUUsSUFBSTtxQkFDWjtpQkFDRjs7YUFDRjs7OztZQW5COEMsVUFBVTtZQUFxQixRQUFROzs7c0JBc0JuRixLQUFLOzBCQUVMLEtBQUs7NEJBRUwsS0FBSzswQkFFTCxLQUFLO3VCQUVMLEtBQUs7MEJBRUwsS0FBSzt1QkFFTCxLQUFLO2tCQUVMLEtBQUs7c0JBRUwsS0FBSzt3QkFFTCxLQUFLO3FCQUVMLEtBQUs7Z0NBRUwsS0FBSzsyQkFZTCxTQUFTLFNBQUMsaUJBQWlCOzJCQUUzQixTQUFTLFNBQUMsaUJBQWlCOzs7O0lBcEM1QiwwQ0FDUTs7SUFDUiw4Q0FDWTs7SUFDWixnREFDYzs7SUFDZCw4Q0FDWTs7SUFDWiwyQ0FDUzs7SUFDVCw4Q0FDWTs7SUFDWiwyQ0FDUzs7SUFDVCxzQ0FDSTs7SUFDSiwwQ0FDUTs7SUFDUiw0Q0FDVTs7SUFDVix5Q0FDTzs7SUFDUCxvREFDa0I7O0lBRWxCLDJDQUFjOztJQUVkLHlDQUVFOzs7OztJQUNGLDJDQUEwQjs7Ozs7SUFDMUIsMkNBQTJCOzs7OztJQUMzQiw0Q0FBNEI7O0lBRTVCLCtDQUNpQzs7SUFDakMsK0NBQ2lDOzs7OztJQUNyQiwwQ0FBMkI7Ozs7O0lBQUUsMkNBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBmb3J3YXJkUmVmLCBFbGVtZW50UmVmLCBWaWV3Q2hpbGQsIEluamVjdCwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IERyb3B6b25lQ29tcG9uZW50LCBEcm9wem9uZURpcmVjdGl2ZSwgRHJvcHpvbmVDb25maWdJbnRlcmZhY2UgfSBmcm9tICduZ3gtZHJvcHpvbmUtd3JhcHBlcic7XG5cblxuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ2N1c3RvbS1kcm9wem9uZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9kcm9wem9uZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2Ryb3B6b25lLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQ3VzdG9tRHJvcHpvbmVDb21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWVcbiAgICB9XG4gIF1cbn0pXG5cbmV4cG9ydCBjbGFzcyBDdXN0b21Ecm9wem9uZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xuICBASW5wdXQoKVxuICBtZXNzYWdlO1xuICBASW5wdXQoKVxuICB1cGxvYWRfcGF0aDtcbiAgQElucHV0KClcbiAgYWNjZXB0ZWRGaWxlcztcbiAgQElucHV0KClcbiAgbWF4RmlsZXNpemU7XG4gIEBJbnB1dCgpXG4gIG1heEZpbGVzO1xuICBASW5wdXQoKVxuICBzaG93UHJldmlldztcbiAgQElucHV0KClcbiAgb2xkVmFsdWU7XG4gIEBJbnB1dCgpXG4gIHVybDtcbiAgQElucHV0KClcbiAgaGVhZGVycztcbiAgQElucHV0KClcbiAgcGFyYW1OYW1lO1xuICBASW5wdXQoKVxuICBfdmFsdWU7XG4gIEBJbnB1dCgpXG4gIHJlc3VsdFRyYW5zZm9ybWVyO1xuXG4gIGZpbGVMaXN0ID0gW107XG5cbiAgY29uZmlnOiBhbnkgPSB7XG4gICAgYWRkUmVtb3ZlTGlua3M6IHRydWVcbiAgfTtcbiAgcHJpdmF0ZSBkaXNhYmxlZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBvbkNoYW5nZTogRnVuY3Rpb247XG4gIHByaXZhdGUgb25Ub3VjaGVkOiBGdW5jdGlvbjtcblxuICBAVmlld0NoaWxkKERyb3B6b25lQ29tcG9uZW50KVxuICBjb21wb25lbnRSZWY/OiBEcm9wem9uZUNvbXBvbmVudDtcbiAgQFZpZXdDaGlsZChEcm9wem9uZURpcmVjdGl2ZSlcbiAgZGlyZWN0aXZlUmVmPzogRHJvcHpvbmVEaXJlY3RpdmU7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gKHZhbDogYW55KSA9PiB7fTtcbiAgICB0aGlzLm9uVG91Y2hlZCA9ICgpID0+IHt9O1xuICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuICB3cml0ZVZhbHVlKHZhbDogYW55KTogdm9pZCB7XG4gICAgaWYgKHZhbCkge1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbDtcbiAgICB9XG4gIH1cblxuICBnZXQgdmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgc2V0IHZhbHVlKHZhbCkge1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsO1xuICAgIHRoaXMub25DaGFuZ2UodGhpcy5fdmFsdWUpO1xuICB9XG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG91Y2hlZCA9IGZuO1xuICB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCBVUExPQURfRElSRUNUSVZFX0hFQURFUlMgPSB0aGlzLmluamVjdG9yLmdldCgnVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTJyk7XG4gICAgY29uc3QgVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMID0gdGhpcy5pbmplY3Rvci5nZXQoJ1VQTE9BRF9ESVJFQ1RJVkVfQVBJX1VSTCcpO1xuICAgIGNvbnN0ICR0aGlzID0gdGhpcztcbiAgICBpZiAodGhpcy5tYXhGaWxlcyAhPT0gMSAmJiAhXy5pc0VtcHR5KCR0aGlzLm9sZFZhbHVlKSkge1xuICAgICAgXy5mb3JFYWNoKHRoaXMub2xkVmFsdWUsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICR0aGlzLmZpbGVMaXN0LnB1c2godmFsdWUpO1xuICAgICAgICAkdGhpcy52YWx1ZSA9ICR0aGlzLmZpbGVMaXN0O1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm1heEZpbGVzID09PSAxICYmICFfLmlzRW1wdHkoJHRoaXMub2xkVmFsdWUpKSB7XG4gICAgICAkdGhpcy52YWx1ZSA9ICR0aGlzLm9sZFZhbHVlO1xuICAgIH1cbiAgICB0aGlzLmNvbmZpZy5wYXJhbXMgPSB7XG4gICAgICB1cGxvYWRfcGF0aDogdGhpcy51cGxvYWRfcGF0aFxuICAgIH07XG4gICAgdGhpcy5jb25maWcudXJsID0gVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMICsgdGhpcy51cmw7XG4gICAgdGhpcy5jb25maWcuaGVhZGVycyA9IFVQTE9BRF9ESVJFQ1RJVkVfSEVBREVSUztcbiAgICB0aGlzLmNvbmZpZy5hY2NlcHRlZEZpbGVzID0gdGhpcy5hY2NlcHRlZEZpbGVzO1xuICAgIHRoaXMuY29uZmlnLm1heEZpbGVzaXplID0gdGhpcy5tYXhGaWxlc2l6ZTtcbiAgICB0aGlzLmNvbmZpZy5tYXhGaWxlcyA9IHRoaXMubWF4RmlsZXM7XG4gICAgdGhpcy5jb25maWcucGFyYW1OYW1lID0gdGhpcy5wYXJhbU5hbWU7XG4gIH1cblxuICBvblVwbG9hZEVycm9yKCRldmVudCkge1xuICAgIC8vIEFwcEluamVjdG9yLmdldChOb3RpZmljYXRpb25TZXJ2aWNlKS5zaG93KCd3YXJuaW5nJywgJGV2ZW50WzFdLCA1MDAwKTtcbiAgICBjb25zb2xlLmxvZygnd2FybmluZycsICRldmVudCk7XG4gIH1cblxuICBvblVwbG9hZFN1Y2Nlc3MoJGV2ZW50KSB7XG4gICAgaWYgKHRoaXMubWF4RmlsZXMgIT09IDEpIHtcbiAgICAgIHRoaXMuZmlsZUxpc3QucHVzaCh0aGlzLnJlc3VsdFRyYW5zZm9ybWVyKCRldmVudFsxXSkpO1xuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZmlsZUxpc3Q7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnJlc3VsdFRyYW5zZm9ybWVyKCRldmVudFsxXSk7XG4gICAgfVxuICB9XG5cbiAgb25SZXNldCgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYgJiYgdGhpcy5jb21wb25lbnRSZWYuZGlyZWN0aXZlUmVmKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5kaXJlY3RpdmVSZWYucmVzZXQoKTtcbiAgICAgIHRoaXMuZmlsZUxpc3QgPSBbXTtcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmZpbGVMaXN0O1xuICAgIH1cbiAgfVxuXG4gIG9uRmlsZVJlbW92ZWQoJGV2ZW50KSB7XG5cbiAgICBjb25zdCBvYmogPSBKU09OLnBhcnNlKCRldmVudC54aHIucmVzcG9uc2UpO1xuICAgIGlmICh0aGlzLm1heEZpbGVzICE9PSAxKSB7XG4gICAgICB0aGlzLmZpbGVMaXN0LnNwbGljZSh0aGlzLmZpbGVMaXN0LmluZGV4T2YodGhpcy5yZXN1bHRUcmFuc2Zvcm1lcihvYmopLCAxKSk7XG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWxlTGlzdDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgZGVsZXRlSXRlbShpdGVtKSB7XG4gICAgdGhpcy5maWxlTGlzdC5zcGxpY2UodGhpcy5maWxlTGlzdC5pbmRleE9mKGl0ZW0pLCAxKTtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy5maWxlTGlzdDtcbiAgfVxuXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS96ZWZveS9uZ3gtZHJvcHpvbmUtd3JhcHBlclxufVxuIl19