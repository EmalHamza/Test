/**
 * @fileoverview added by tsickle
 * Generated from: lib/components/reactive-form/reactive-form.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { FormControlService } from '../../services/form-control.service';
import * as _ from 'lodash';
import { PhoneCode } from '../../models/PhoneCode';
import { TinyMce } from '../../models/TinyMce';
import { CheckBox } from '../../models/CheckBox';
import { SwitchInput } from '../../models/SwitchInput';
import { SelectionByApi } from '../../models/SelectionByApi';
import { Select2 } from '../../models/Select2';
import { ListCheckBox } from '../../models/ListCheckBox';
export class ReactiveFormComponent {
    /**
     * @param {?} fcs
     */
    constructor(fcs) {
        this.fcs = fcs;
        this.groups = [];
        this.inputs = [];
        this.captchaCorrect = true;
        this.values = {};
        this.submitted = false;
        this.clear = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.onInitReactive) {
            this.onInitReactive.apply(null, [this.form]);
        }
    }
    /**
     * @return {?}
     */
    onChangesReactive() {
        /** @type {?} */
        const $this = this;
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.keysChange !== undefined) {
                _.forEach(this.keysChange, (/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) {
                    $this.form.get(value).valueChanges.subscribe((/**
                     * @param {?} val
                     * @return {?}
                     */
                    (val) => {
                        $this.values[value] = val;
                        $this.form.value[value] = val;
                        $this.onChangeReactive.apply(null, [$this.form]);
                    }));
                }));
            }
            else {
                this.form.valueChanges.subscribe((/**
                 * @param {?} val
                 * @return {?}
                 */
                (val) => {
                    if (this.onChangeReactive !== undefined) {
                        this.onChangeReactive.apply(null, [this.form]);
                    }
                }));
            }
        }), 500);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const groups = [];
        /** @type {?} */
        const grouped = _.groupBy(this.inputs, 'group');
        // tslint:disable-next-line:forin
        for (const k in grouped) {
            groups.push({
                group: k,
                items: grouped[k],
                classes: _.head(grouped[k]).group_classes
            });
        }
        this.groups = groups;
        this.form = this.fcs.toFormGroup(this.inputs);
        this.onChangesReactive();
    }
    /**
     * @return {?}
     */
    submit() {
        this.submitted = true;
        if (this.form.invalid) {
            if (this.scrollOnErrror && this.scrollOnErrror === true) {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    $('html, body').animate({
                        scrollTop: $('.errorMessage').first().offset().top - 70
                    }, 1000);
                }), 100);
            }
            return false;
        }
        if (this.captcha && this.form.value[`${this.captcha}`].value !== this.form.value[`${this.captcha}`].code) {
            this.captchaCorrect = false;
            return false;
        }
        this.captchaCorrect = true;
        if (this.onSubmit !== undefined) {
            delete this.form.value[''];
            this.onSubmit.apply(null, [this.form]);
        }
        this.clear = false;
        if (!this.saveValue || this.saveValue === false) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.clearData();
            }), 2);
        }
    }
    /**
     * @return {?}
     */
    resetFunction() {
        if (confirm('Are you sure want to reset this form?')) {
            this.clearData();
        }
    }
    /**
     * @return {?}
     */
    customSubmitFunction() {
        this.submitted = true;
        if (this.form.invalid) {
            return false;
        }
        if (this.customSubmit !== undefined) {
            delete this.form.value[''];
            this.customSubmit.apply(null, [this.form]);
        }
        this.clear = false;
    }
    /**
     * @return {?}
     */
    customButtonFunction() {
        if (this.customButton !== undefined) {
            this.customButton.apply(null, []);
        }
    }
    /**
     * @return {?}
     */
    clearData() {
        this.clear = true;
        this.submitted = false;
        /** @type {?} */
        const data = {};
        _.forEach(this.inputs, (/**
         * @param {?} input
         * @return {?}
         */
        (input) => {
            if (input.controlType === new PhoneCode().controlType) {
                data[input.key] = {
                    code: '',
                    value: ''
                };
            }
            if (input.controlType === new TinyMce().controlType) {
                data[input.key] = '';
            }
            if (input.controlType === new CheckBox().controlType || input.controlType === new SwitchInput().controlType) {
                input.value = false;
            }
            if (input.controlType === new SelectionByApi().controlType) {
                input.value = null;
            }
            if (input.controlType === new Select2().controlType || input.controlType === new ListCheckBox().controlType) {
                input.value = [];
            }
        }));
        this.form.reset(data);
        _.forEach(this.inputs, (/**
         * @param {?} input
         * @return {?}
         */
        (input) => {
            if (input.controlType === new CheckBox().controlType || input.controlType === new SwitchInput().controlType) {
                input.value = false;
            }
            if (input.controlType === new SelectionByApi().controlType) {
                input.value = null;
            }
            if (input.controlType === new Select2().controlType || input.controlType === new ListCheckBox().controlType) {
                input.value = [];
            }
        }));
        this.form.markAsPristine();
        this.form.markAsUntouched();
    }
}
ReactiveFormComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'reactive-form',
                template: "<form autocomplete=\"off\" (ngSubmit)=\"submit()\" [formGroup]=\"form\" id=\"{{ themeID ? themeID : 'none' }}\">\r\n  <div class=\"row\">\r\n    <div class=\"dynamic-collection\" *ngFor=\"let group of groups\" [ngClass]=\"group.classes\">\r\n      <div class=\"row\">\r\n        <div *ngFor=\"let input of group.items\" class=\"dynamic-input-group\" [ngClass]=\"input.classes\">\r\n          <dynamic-input\r\n            [captchaCorrect]=\"captchaCorrect\"\r\n            [isClear]=\"clear\"\r\n            [input]=\"input\"\r\n            [form]=\"form\"\r\n            [submitted]=\"submitted\"\r\n          ></dynamic-input>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"dynamic-submit-btn\">\r\n    <button type=\"submit\" [ngClass]=\"{ disabled: !form.valid }\" class=\"btn btn-primary m-r-15 ripple light\">\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ submitText !== undefined ? submitText : 'Submit' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"isReset !== undefined && isReset === true\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"resetFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ resetText !== undefined ? resetText : 'Reset' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"customSubmit !== undefined\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"customSubmitFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ customeSubmitText !== undefined ? customeSubmitText : 'Custom Submit' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"customButton !== undefined\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"customButtonFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ customButtonText !== undefined ? customButtonText : 'Custom Button' }}\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                providers: [FormControlService],
                styles: [":host .dynamic-collection{margin-bottom:10px}:host .btn-reset{float:right}:host .rf__captcha--error{margin-top:15px;color:#e74c3c;font-size:15px}"]
            }] }
];
/** @nocollapse */
ReactiveFormComponent.ctorParameters = () => [
    { type: FormControlService }
];
ReactiveFormComponent.propDecorators = {
    inputs: [{ type: Input }],
    onSubmit: [{ type: Input }],
    submitText: [{ type: Input }],
    onChangeReactive: [{ type: Input }],
    keysChange: [{ type: Input }],
    isReset: [{ type: Input }],
    resetText: [{ type: Input }],
    customSubmit: [{ type: Input }],
    customButton: [{ type: Input }],
    customeSubmitText: [{ type: Input }],
    customButtonText: [{ type: Input }],
    saveValue: [{ type: Input }],
    captcha: [{ type: Input }],
    scrollOnErrror: [{ type: Input }],
    themeID: [{ type: Input }],
    onInitReactive: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ReactiveFormComponent.prototype.groups;
    /** @type {?} */
    ReactiveFormComponent.prototype.inputs;
    /** @type {?} */
    ReactiveFormComponent.prototype.onSubmit;
    /** @type {?} */
    ReactiveFormComponent.prototype.submitText;
    /** @type {?} */
    ReactiveFormComponent.prototype.onChangeReactive;
    /** @type {?} */
    ReactiveFormComponent.prototype.keysChange;
    /** @type {?} */
    ReactiveFormComponent.prototype.isReset;
    /** @type {?} */
    ReactiveFormComponent.prototype.resetText;
    /** @type {?} */
    ReactiveFormComponent.prototype.customSubmit;
    /** @type {?} */
    ReactiveFormComponent.prototype.customButton;
    /** @type {?} */
    ReactiveFormComponent.prototype.customeSubmitText;
    /** @type {?} */
    ReactiveFormComponent.prototype.customButtonText;
    /** @type {?} */
    ReactiveFormComponent.prototype.saveValue;
    /** @type {?} */
    ReactiveFormComponent.prototype.captcha;
    /** @type {?} */
    ReactiveFormComponent.prototype.scrollOnErrror;
    /** @type {?} */
    ReactiveFormComponent.prototype.themeID;
    /** @type {?} */
    ReactiveFormComponent.prototype.onInitReactive;
    /** @type {?} */
    ReactiveFormComponent.prototype.captchaCorrect;
    /** @type {?} */
    ReactiveFormComponent.prototype.values;
    /** @type {?} */
    ReactiveFormComponent.prototype.form;
    /** @type {?} */
    ReactiveFormComponent.prototype.submitted;
    /** @type {?} */
    ReactiveFormComponent.prototype.clear;
    /**
     * @type {?}
     * @private
     */
    ReactiveFormComponent.prototype.fcs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhY3RpdmUtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Admljb2RlcnMvcmVhY3RpdmUtZm9ybS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3JlYWN0aXZlLWZvcm0vcmVhY3RpdmUtZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFbkYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBVXpELE1BQU0sT0FBTyxxQkFBcUI7Ozs7SUF3QmhDLFlBQW9CLEdBQXVCO1FBQXZCLFFBQUcsR0FBSCxHQUFHLENBQW9CO1FBdkIzQyxXQUFNLEdBQXFCLEVBQUUsQ0FBQztRQUNyQixXQUFNLEdBQXFCLEVBQUUsQ0FBQztRQWdCdkMsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFFdEIsV0FBTSxHQUFRLEVBQUUsQ0FBQztRQUVqQixjQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLFVBQUssR0FBWSxLQUFLLENBQUM7SUFDdUIsQ0FBQzs7OztJQUUvQyxRQUFRO1FBQ04sSUFBSSxJQUFJLENB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SUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUM5QixDQUFDOzs7WUEvS0YsU0FBUyxTQUFDOztnQkFFVCxRQUFRLEVBQUUsZUFBZTtnQkFDekIsOC9EQUE2QztnQkFFN0MsU0FBUyxFQUFFLENBQUMsa0JBQWtCLENBQUM7O2FBQ2hDOzs7O1lBbEJRLGtCQUFrQjs7O3FCQXFCeEIsS0FBSzt1QkFDTCxLQUFLO3lCQUNMLEtBQUs7K0JBQ0wsS0FBSzt5QkFDTCxLQUFLO3NCQUNMLEtBQUs7d0JBQ0wsS0FBSzsyQkFDTCxLQUFLOzJCQUNMLEtBQUs7Z0NBQ0wsS0FBSzsrQkFDTCxLQUFLO3dCQUNMLEtBQUs7c0JBQ0wsS0FBSzs2QkFDTCxLQUFLO3NCQUNMLEtBQUs7NkJBQ0wsS0FBSzs7OztJQWhCTix1Q0FBOEI7O0lBQzlCLHVDQUF1Qzs7SUFDdkMseUNBQTZCOztJQUM3QiwyQ0FBNkI7O0lBQzdCLGlEQUFxQzs7SUFDckMsMkNBQTBCOztJQUMxQix3Q0FBMkI7O0lBQzNCLDBDQUE0Qjs7SUFDNUIsNkNBQWlDOztJQUNqQyw2Q0FBaUM7O0lBQ2pDLGtEQUFvQzs7SUFDcEMsaURBQW1DOztJQUNuQywwQ0FBNkI7O0lBQzdCLHdDQUEwQjs7SUFDMUIsK0NBQWtDOztJQUNsQyx3Q0FBMEI7O0lBQzFCLCtDQUFtQzs7SUFDbkMsK0NBQXNCOztJQUV0Qix1Q0FBaUI7O0lBQ2pCLHFDQUFnQjs7SUFDaEIsMENBQTJCOztJQUMzQixzQ0FBdUI7Ozs7O0lBQ1gsb0NBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSW5wdXRCYXNlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL0lucHV0QmFzZSc7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2Zvcm0tY29udHJvbC5zZXJ2aWNlJztcclxuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFBob25lQ29kZSB9IGZyb20gJy4uLy4uL21vZGVscy9QaG9uZUNvZGUnO1xyXG5pbXBvcnQgeyBUaW55TWNlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1RpbnlNY2UnO1xyXG5pbXBvcnQgeyBDaGVja0JveCB9IGZyb20gJy4uLy4uL21vZGVscy9DaGVja0JveCc7XHJcbmltcG9ydCB7IFN3aXRjaElucHV0IH0gZnJvbSAnLi4vLi4vbW9kZWxzL1N3aXRjaElucHV0JztcclxuaW1wb3J0IHsgU2VsZWN0aW9uQnlBcGkgfSBmcm9tICcuLi8uLi9tb2RlbHMvU2VsZWN0aW9uQnlBcGknO1xyXG5pbXBvcnQgeyBTZWxlY3QyIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1NlbGVjdDInO1xyXG5pbXBvcnQgeyBMaXN0Q2hlY2tCb3ggfSBmcm9tICcuLi8uLi9tb2RlbHMvTGlzdENoZWNrQm94JztcclxuZGVjbGFyZSBjb25zdCAkOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXHJcbiAgc2VsZWN0b3I6ICdyZWFjdGl2ZS1mb3JtJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcmVhY3RpdmUtZm9ybS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcmVhY3RpdmUtZm9ybS5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW0Zvcm1Db250cm9sU2VydmljZV1cclxufSlcclxuZXhwb3J0IGNsYXNzIFJlYWN0aXZlRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBncm91cHM6IElucHV0QmFzZTxhbnk+W10gPSBbXTtcclxuICBASW5wdXQoKSBpbnB1dHM6IElucHV0QmFzZTxhbnk+W10gPSBbXTtcclxuICBASW5wdXQoKSBvblN1Ym1pdD86IEZ1bmN0aW9uO1xyXG4gIEBJbnB1dCgpIHN1Ym1pdFRleHQ/OiBTdHJpbmc7XHJcbiAgQElucHV0KCkgb25DaGFuZ2VSZWFjdGl2ZT86IEZ1bmN0aW9uO1xyXG4gIEBJbnB1dCgpIGtleXNDaGFuZ2U/OiBhbnk7XHJcbiAgQElucHV0KCkgaXNSZXNldD86IEJvb2xlYW47XHJcbiAgQElucHV0KCkgcmVzZXRUZXh0PzogU3RyaW5nO1xyXG4gIEBJbnB1dCgpIGN1c3RvbVN1Ym1pdD86IEZ1bmN0aW9uO1xyXG4gIEBJbnB1dCgpIGN1c3RvbUJ1dHRvbj86IEZ1bmN0aW9uO1xyXG4gIEBJbnB1dCgpIGN1c3RvbWVTdWJtaXRUZXh0PzogU3RyaW5nO1xyXG4gIEBJbnB1dCgpIGN1c3RvbUJ1dHRvblRleHQ/OiBTdHJpbmc7XHJcbiAgQElucHV0KCkgc2F2ZVZhbHVlPzogQm9vbGVhbjtcclxuICBASW5wdXQoKSBjYXB0Y2hhPzogU3RyaW5nO1xyXG4gIEBJbnB1dCgpIHNjcm9sbE9uRXJycm9yPzogQm9vbGVhbjtcclxuICBASW5wdXQoKSB0aGVtZUlEPzogU3RyaW5nO1xyXG4gIEBJbnB1dCgpIG9uSW5pdFJlYWN0aXZlPzogRnVuY3Rpb247XHJcbiAgY2FwdGNoYUNvcnJlY3QgPSB0cnVlO1xyXG5cclxuICB2YWx1ZXM6IGFueSA9IHt9O1xyXG4gIGZvcm06IEZvcm1Hcm91cDtcclxuICBzdWJtaXR0ZWQ6IEJvb2xlYW4gPSBmYWxzZTtcclxuICBjbGVhcjogQm9vbGVhbiA9IGZhbHNlO1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmNzOiBGb3JtQ29udHJvbFNlcnZpY2UpIHt9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMub25Jbml0UmVhY3RpdmUpIHtcclxuICAgICAgdGhpcy5vbkluaXRSZWFjdGl2ZS5hcHBseShudWxsLCBbdGhpcy5mb3JtXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZXNSZWFjdGl2ZSgpIHtcclxuICAgIGNvbnN0ICR0aGlzID0gdGhpcztcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5rZXlzQ2hhbmdlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBfLmZvckVhY2godGhpcy5rZXlzQ2hhbmdlLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICR0aGlzLmZvcm0uZ2V0KHZhbHVlKS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2YWwpID0+IHtcclxuICAgICAgICAgICAgJHRoaXMudmFsdWVzW3ZhbHVlXSA9IHZhbDtcclxuICAgICAgICAgICAgJHRoaXMuZm9ybS52YWx1ZVt2YWx1ZV0gPSB2YWw7XHJcbiAgICAgICAgICAgICR0aGlzLm9uQ2hhbmdlUmVhY3RpdmUuYXBwbHkobnVsbCwgWyR0aGlzLmZvcm1dKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZm9ybS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2YWwpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLm9uQ2hhbmdlUmVhY3RpdmUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlUmVhY3RpdmUuYXBwbHkobnVsbCwgW3RoaXMuZm9ybV0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9LCA1MDApO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc3QgZ3JvdXBzID0gW107XHJcbiAgICBjb25zdCBncm91cGVkID0gXy5ncm91cEJ5KHRoaXMuaW5wdXRzLCAnZ3JvdXAnKTtcclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Zm9yaW5cclxuICAgIGZvciAoY29uc3QgayBpbiBncm91cGVkKSB7XHJcbiAgICAgIGdyb3Vwcy5wdXNoKHtcclxuICAgICAgICBncm91cDogayxcclxuICAgICAgICBpdGVtczogZ3JvdXBlZFtrXSxcclxuICAgICAgICBjbGFzc2VzOiBfLmhlYWQoZ3JvdXBlZFtrXSkuZ3JvdXBfY2xhc3Nlc1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuZ3JvdXBzID0gZ3JvdXBzO1xyXG4gICAgdGhpcy5mb3JtID0gdGhpcy5mY3MudG9Gb3JtR3JvdXAodGhpcy5pbnB1dHMpO1xyXG4gICAgdGhpcy5vbkNoYW5nZXNSZWFjdGl2ZSgpO1xyXG4gIH1cclxuXHJcbiAgc3VibWl0KCkge1xyXG4gICAgdGhpcy5zdWJtaXR0ZWQgPSB0cnVlO1xyXG4gICAgaWYgKHRoaXMuZm9ybS5pbnZhbGlkKSB7XHJcbiAgICAgIGlmICh0aGlzLnNjcm9sbE9uRXJycm9yICYmIHRoaXMuc2Nyb2xsT25FcnJyb3IgPT09IHRydWUpIHtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCcuZXJyb3JNZXNzYWdlJykuZmlyc3QoKS5vZmZzZXQoKS50b3AgLSA3MFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAxMDAwXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY2FwdGNoYSAmJiB0aGlzLmZvcm0udmFsdWVbYCR7dGhpcy5jYXB0Y2hhfWBdLnZhbHVlICE9PSB0aGlzLmZvcm0udmFsdWVbYCR7dGhpcy5jYXB0Y2hhfWBdLmNvZGUpIHtcclxuICAgICAgdGhpcy5jYXB0Y2hhQ29ycmVjdCA9IGZhbHNlO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNhcHRjaGFDb3JyZWN0ID0gdHJ1ZTtcclxuXHJcbiAgICBpZiAodGhpcy5vblN1Ym1pdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGRlbGV0ZSB0aGlzLmZvcm0udmFsdWVbJyddO1xyXG4gICAgICB0aGlzLm9uU3VibWl0LmFwcGx5KG51bGwsIFt0aGlzLmZvcm1dKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNsZWFyID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKCF0aGlzLnNhdmVWYWx1ZSB8fCB0aGlzLnNhdmVWYWx1ZSA9PT0gZmFsc2UpIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbGVhckRhdGEoKTtcclxuICAgICAgfSwgMik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXNldEZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB3YW50IHRvIHJlc2V0IHRoaXMgZm9ybT8nKSkge1xyXG4gICAgICB0aGlzLmNsZWFyRGF0YSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3VzdG9tU3VibWl0RnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLnN1Ym1pdHRlZCA9IHRydWU7XHJcbiAgICBpZiAodGhpcy5mb3JtLmludmFsaWQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY3VzdG9tU3VibWl0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgZGVsZXRlIHRoaXMuZm9ybS52YWx1ZVsnJ107XHJcbiAgICAgIHRoaXMuY3VzdG9tU3VibWl0LmFwcGx5KG51bGwsIFt0aGlzLmZvcm1dKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2xlYXIgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGN1c3RvbUJ1dHRvbkZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKHRoaXMuY3VzdG9tQnV0dG9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5jdXN0b21CdXR0b24uYXBwbHkobnVsbCwgW10pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xlYXJEYXRhKCkge1xyXG4gICAgdGhpcy5jbGVhciA9IHRydWU7XHJcbiAgICB0aGlzLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgZGF0YSA9IHt9O1xyXG4gICAgXy5mb3JFYWNoKHRoaXMuaW5wdXRzLCAoaW5wdXQpID0+IHtcclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgUGhvbmVDb2RlKCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBkYXRhW2lucHV0LmtleV0gPSB7XHJcbiAgICAgICAgICBjb2RlOiAnJyxcclxuICAgICAgICAgIHZhbHVlOiAnJ1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgVGlueU1jZSgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgZGF0YVtpbnB1dC5rZXldID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgQ2hlY2tCb3goKS5jb250cm9sVHlwZSB8fCBpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFN3aXRjaElucHV0KCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFNlbGVjdGlvbkJ5QXBpKCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgU2VsZWN0MigpLmNvbnRyb2xUeXBlIHx8IGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgTGlzdENoZWNrQm94KCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IFtdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuZm9ybS5yZXNldChkYXRhKTtcclxuICAgIF8uZm9yRWFjaCh0aGlzLmlucHV0cywgKGlucHV0KSA9PiB7XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IENoZWNrQm94KCkuY29udHJvbFR5cGUgfHwgaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBTd2l0Y2hJbnB1dCgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBTZWxlY3Rpb25CeUFwaSgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFNlbGVjdDIoKS5jb250cm9sVHlwZSB8fCBpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IExpc3RDaGVja0JveCgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBbXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5mb3JtLm1hcmtBc1ByaXN0aW5lKCk7XHJcbiAgICB0aGlzLmZvcm0ubWFya0FzVW50b3VjaGVkKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==