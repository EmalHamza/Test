/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/dropzone/dropzone.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, forwardRef, ElementRef, ViewChild, Injector } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import * as _ from 'lodash';
import { DropzoneComponent, DropzoneDirective } from 'ngx-dropzone-wrapper';
var CustomDropzoneComponent = /** @class */ (function () {
    function CustomDropzoneComponent(element, injector) {
        this.element = element;
        this.injector = injector;
        this.fileList = [];
        this.config = {
            addRemoveLinks: true
        };
        this.onChange = (/**
         * @param {?} val
         * @return {?}
         */
        function (val) { });
        this.onTouched = (/**
         * @return {?}
         */
        function () { });
        this.disabled = false;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    CustomDropzoneComponent.prototype.writeValue = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            this.value = val;
        }
    };
    Object.defineProperty(CustomDropzoneComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._value = val;
            this.onChange(this._value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} fn
     * @return {?}
     */
    CustomDropzoneComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    CustomDropzoneComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    CustomDropzoneComponent.prototype.setDisabledState = /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        this.disabled = isDisabled;
    };
    /**
     * @return {?}
     */
    CustomDropzoneComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var UPLOAD_DIRECTIVE_HEADERS = this.injector.get('UPLOAD_DIRECTIVE_HEADERS');
        /** @type {?} */
        var UPLOAD_DIRECTIVE_API_URL = this.injector.get('UPLOAD_DIRECTIVE_API_URL');
        /** @type {?} */
        var $this = this;
        if (this.maxFiles !== 1 && !_.isEmpty($this.oldValue)) {
            _.forEach(this.oldValue, (/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                $this.fileList.push(value);
                $this.value = $this.fileList;
            }));
        }
        if (this.maxFiles === 1 && !_.isEmpty($this.oldValue)) {
            $this.value = $this.oldValue;
        }
        this.config.params = {
            upload_path: this.upload_path
        };
        this.config.url = UPLOAD_DIRECTIVE_API_URL + this.url;
        this.config.headers = UPLOAD_DIRECTIVE_HEADERS;
        this.config.acceptedFiles = this.acceptedFiles;
        this.config.maxFilesize = this.maxFilesize;
        this.config.maxFiles = this.maxFiles;
        this.config.paramName = this.paramName;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    CustomDropzoneComponent.prototype.onUploadError = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // AppInjector.get(NotificationService).show('warning', $event[1], 5000);
        console.log('warning', $event);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    CustomDropzoneComponent.prototype.onUploadSuccess = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.maxFiles !== 1) {
            this.fileList.push(this.resultTransformer($event[1]));
            this.value = this.fileList;
        }
        else {
            this.value = this.resultTransformer($event[1]);
        }
    };
    /**
     * @return {?}
     */
    CustomDropzoneComponent.prototype.onReset = /**
     * @return {?}
     */
    function () {
        if (this.componentRef && this.componentRef.directiveRef) {
            this.componentRef.directiveRef.reset();
            this.fileList = [];
            this.value = this.fileList;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    CustomDropzoneComponent.prototype.onFileRemoved = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var obj = JSON.parse($event.xhr.response);
        if (this.maxFiles !== 1) {
            this.fileList.splice(this.fileList.indexOf(this.resultTransformer(obj), 1));
            this.value = this.fileList;
        }
        else {
            this.value = null;
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    CustomDropzoneComponent.prototype.deleteItem = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.fileList.splice(this.fileList.indexOf(item), 1);
        this.value = this.fileList;
    };
    CustomDropzoneComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'custom-dropzone',
                    template: "<dropzone (removedFile)=\"onFileRemoved($event)\" [config]=\"config\" [message]=\"message\" (error)=\"onUploadError($event)\" (success)=\"onUploadSuccess($event)\"></dropzone>\n\n<div class=\"preview-frame\" *ngIf=\"showPreview\">\n    <p>Descriptive images of the product</p>\n    <div *ngIf=\"maxFiles !== 1\">\n        <span class=\"group-item\" *ngFor=\"let item of value\">\n            <img class=\"singleImg\" width=\"120\" height=\"120\" [src]=\"item\" alt=\"\">\n            <span (click)=\"deleteItem(item)\">Remove File</span>\n        </span>\n    </div>\n    <div *ngIf=\"maxFiles == 1\">\n        <img class=\"singleImg\" width=\"120\" height=\"120\" [src]=\"value\" alt=\"\">\n    </div>\n</div>\n\n<div class=\"btn-reset\">\n    <a class=\"btn btn-primary\" (click)=onReset()>Reset</a>\n</div>\n",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return CustomDropzoneComponent; })),
                            multi: true
                        }
                    ],
                    styles: [".singleImg{border:1px solid #000;padding:3px;margin-right:5px}.preview-frame{padding:8px}.preview-frame .group-item{position:relative}.preview-frame .group-item span{position:absolute;top:73px;left:18px;cursor:pointer}p{padding:8px 16px;text-align:center;border:2px dashed;color:#666;font-size:14px;letter-spacing:1px;background:#dcdcdc}.btn-reset{text-align:right}.btn-reset a{margin:8px;color:#fff}"]
                }] }
    ];
    /** @nocollapse */
    CustomDropzoneComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Injector }
    ]; };
    CustomDropzoneComponent.propDecorators = {
        message: [{ type: Input }],
        upload_path: [{ type: Input }],
        acceptedFiles: [{ type: Input }],
        maxFilesize: [{ type: Input }],
        maxFiles: [{ type: Input }],
        showPreview: [{ type: Input }],
        oldValue: [{ type: Input }],
        url: [{ type: Input }],
        headers: [{ type: Input }],
        paramName: [{ type: Input }],
        _value: [{ type: Input }],
        resultTransformer: [{ type: Input }],
        componentRef: [{ type: ViewChild, args: [DropzoneComponent,] }],
        directiveRef: [{ type: ViewChild, args: [DropzoneDirective,] }]
    };
    return CustomDropzoneComponent;
}());
export { CustomDropzoneComponent };
if (false) {
    /** @type {?} */
    CustomDropzoneComponent.prototype.message;
    /** @type {?} */
    CustomDropzoneComponent.prototype.upload_path;
    /** @type {?} */
    CustomDropzoneComponent.prototype.acceptedFiles;
    /** @type {?} */
    CustomDropzoneComponent.prototype.maxFilesize;
    /** @type {?} */
    CustomDropzoneComponent.prototype.maxFiles;
    /** @type {?} */
    CustomDropzoneComponent.prototype.showPreview;
    /** @type {?} */
    CustomDropzoneComponent.prototype.oldValue;
    /** @type {?} */
    CustomDropzoneComponent.prototype.url;
    /** @type {?} */
    CustomDropzoneComponent.prototype.headers;
    /** @type {?} */
    CustomDropzoneComponent.prototype.paramName;
    /** @type {?} */
    CustomDropzoneComponent.prototype._value;
    /** @type {?} */
    CustomDropzoneComponent.prototype.resultTransformer;
    /** @type {?} */
    CustomDropzoneComponent.prototype.fileList;
    /** @type {?} */
    CustomDropzoneComponent.prototype.config;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.disabled;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.onChange;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.onTouched;
    /** @type {?} */
    CustomDropzoneComponent.prototype.componentRef;
    /** @type {?} */
    CustomDropzoneComponent.prototype.directiveRef;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.element;
    /**
     * @type {?}
     * @private
     */
    CustomDropzoneComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHpvbmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZpY29kZXJzL3JlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9kcm9wem9uZS9kcm9wem9uZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUcsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxpQkFBaUIsRUFBMkIsTUFBTSxzQkFBc0IsQ0FBQztBQUlyRztJQXFERSxpQ0FBb0IsT0FBbUIsRUFBVSxRQUFrQjtRQUEvQyxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWJuRSxhQUFRLEdBQUcsRUFBRSxDQUFDO1FBRWQsV0FBTSxHQUFRO1lBQ1osY0FBYyxFQUFFLElBQUk7U0FDckIsQ0FBQztRQVVBLElBQUksQ0FBQyxRQUFROzs7O1FBQUcsVUFBQyxHQUFRLElBQU0sQ0FBQyxDQUFBLENBQUM7UUFDakMsSUFBSSxDQUFDLFNBQVM7OztRQUFHLGNBQU8sQ0FBQyxDQUFBLENBQUM7UUFDMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQzs7Ozs7SUFDRCw0Q0FBVTs7OztJQUFWLFVBQVcsR0FBUTtRQUNqQixJQUFJLEdBQUcsRUFBRTtZQUNQLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1NBQ2xCO0lBQ0gsQ0FBQztJQUVELHNCQUFJLDBDQUFLOzs7O1FBQVQ7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDckIsQ0FBQzs7Ozs7UUFFRCxV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QUUsVUFBVTs7OzRCQUFDLGNBQU0sT0FBQSx1QkFBdUIsRUFBdkIsQ0FBdUIsRUFBQzs0QkFDdEQsS0FBSyxFQUFFLElBQUk7eUJBQ1o7cUJBQ0Y7O2lCQUNGOzs7O2dCQW5COEMsVUFBVTtnQkFBcUIsUUFBUTs7OzBCQXNCbkYsS0FBSzs4QkFFTCxLQUFLO2dDQUVMLEtBQUs7OEJBRUwsS0FBSzsyQkFFTCxLQUFLOzhCQUVMLEtBQUs7MkJBRUwsS0FBSztzQkFFTCxLQUFLOzBCQUVMLEtBQUs7NEJBRUwsS0FBSzt5QkFFTCxLQUFLO29DQUVMLEtBQUs7K0JBWUwsU0FBUyxTQUFDLGlCQUFpQjsrQkFFM0IsU0FBUyxTQUFDLGlCQUFpQjs7SUFnRzlCLDhCQUFDO0NBQUEsQUFuSkQsSUFtSkM7U0FySVksdUJBQXVCOzs7SUFDbEMsMENBQ1E7O0lBQ1IsOENBQ1k7O0lBQ1osZ0RBQ2M7O0lBQ2QsOENBQ1k7O0lBQ1osMkNBQ1M7O0lBQ1QsOENBQ1k7O0lBQ1osMkNBQ1M7O0lBQ1Qsc0NBQ0k7O0lBQ0osMENBQ1E7O0lBQ1IsNENBQ1U7O0lBQ1YseUNBQ087O0lBQ1Asb0RBQ2tCOztJQUVsQiwyQ0FBYzs7SUFFZCx5Q0FFRTs7Ozs7SUFDRiwyQ0FBMEI7Ozs7O0lBQzFCLDJDQUEyQjs7Ozs7SUFDM0IsNENBQTRCOztJQUU1QiwrQ0FDaUM7O0lBQ2pDLCtDQUNpQzs7Ozs7SUFDckIsMENBQTJCOzs7OztJQUFFLDJDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgZm9yd2FyZFJlZiwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBJbmplY3QsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBEcm9wem9uZUNvbXBvbmVudCwgRHJvcHpvbmVEaXJlY3RpdmUsIERyb3B6b25lQ29uZmlnSW50ZXJmYWNlIH0gZnJvbSAnbmd4LWRyb3B6b25lLXdyYXBwZXInO1xuXG5cblxuQENvbXBvbmVudCh7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtc2VsZWN0b3JcbiAgc2VsZWN0b3I6ICdjdXN0b20tZHJvcHpvbmUnLFxuICB0ZW1wbGF0ZVVybDogJy4vZHJvcHpvbmUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kcm9wem9uZS5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEN1c3RvbURyb3B6b25lQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdXG59KVxuXG5leHBvcnQgY2xhc3MgQ3VzdG9tRHJvcHpvbmVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgQElucHV0KClcbiAgbWVzc2FnZTtcbiAgQElucHV0KClcbiAgdXBsb2FkX3BhdGg7XG4gIEBJbnB1dCgpXG4gIGFjY2VwdGVkRmlsZXM7XG4gIEBJbnB1dCgpXG4gIG1heEZpbGVzaXplO1xuICBASW5wdXQoKVxuICBtYXhGaWxlcztcbiAgQElucHV0KClcbiAgc2hvd1ByZXZpZXc7XG4gIEBJbnB1dCgpXG4gIG9sZFZhbHVlO1xuICBASW5wdXQoKVxuICB1cmw7XG4gIEBJbnB1dCgpXG4gIGhlYWRlcnM7XG4gIEBJbnB1dCgpXG4gIHBhcmFtTmFtZTtcbiAgQElucHV0KClcbiAgX3ZhbHVlO1xuICBASW5wdXQoKVxuICByZXN1bHRUcmFuc2Zvcm1lcjtcblxuICBmaWxlTGlzdCA9IFtdO1xuXG4gIGNvbmZpZzogYW55ID0ge1xuICAgIGFkZFJlbW92ZUxpbmtzOiB0cnVlXG4gIH07XG4gIHByaXZhdGUgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIHByaXZhdGUgb25DaGFuZ2U6IEZ1bmN0aW9uO1xuICBwcml2YXRlIG9uVG91Y2hlZDogRnVuY3Rpb247XG5cbiAgQFZpZXdDaGlsZChEcm9wem9uZUNvbXBvbmVudClcbiAgY29tcG9uZW50UmVmPzogRHJvcHpvbmVDb21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoRHJvcHpvbmVEaXJlY3RpdmUpXG4gIGRpcmVjdGl2ZVJlZj86IERyb3B6b25lRGlyZWN0aXZlO1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XG4gICAgdGhpcy5vbkNoYW5nZSA9ICh2YWw6IGFueSkgPT4ge307XG4gICAgdGhpcy5vblRvdWNoZWQgPSAoKSA9PiB7fTtcbiAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbiAgd3JpdGVWYWx1ZSh2YWw6IGFueSk6IHZvaWQge1xuICAgIGlmICh2YWwpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWw7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIHNldCB2YWx1ZSh2YWwpIHtcbiAgICB0aGlzLl92YWx1ZSA9IHZhbDtcbiAgICB0aGlzLm9uQ2hhbmdlKHRoaXMuX3ZhbHVlKTtcbiAgfVxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgY29uc3QgVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTID0gdGhpcy5pbmplY3Rvci5nZXQoJ1VQTE9BRF9ESVJFQ1RJVkVfSEVBREVSUycpO1xuICAgIGNvbnN0IFVQTE9BRF9ESVJFQ1RJVkVfQVBJX1VSTCA9IHRoaXMuaW5qZWN0b3IuZ2V0KCdVUExPQURfRElSRUNUSVZFX0FQSV9VUkwnKTtcbiAgICBjb25zdCAkdGhpcyA9IHRoaXM7XG4gICAgaWYgKHRoaXMubWF4RmlsZXMgIT09IDEgJiYgIV8uaXNFbXB0eSgkdGhpcy5vbGRWYWx1ZSkpIHtcbiAgICAgIF8uZm9yRWFjaCh0aGlzLm9sZFZhbHVlLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAkdGhpcy5maWxlTGlzdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgJHRoaXMudmFsdWUgPSAkdGhpcy5maWxlTGlzdDtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhGaWxlcyA9PT0gMSAmJiAhXy5pc0VtcHR5KCR0aGlzLm9sZFZhbHVlKSkge1xuICAgICAgJHRoaXMudmFsdWUgPSAkdGhpcy5vbGRWYWx1ZTtcbiAgICB9XG4gICAgdGhpcy5jb25maWcucGFyYW1zID0ge1xuICAgICAgdXBsb2FkX3BhdGg6IHRoaXMudXBsb2FkX3BhdGhcbiAgICB9O1xuICAgIHRoaXMuY29uZmlnLnVybCA9IFVQTE9BRF9ESVJFQ1RJVkVfQVBJX1VSTCArIHRoaXMudXJsO1xuICAgIHRoaXMuY29uZmlnLmhlYWRlcnMgPSBVUExPQURfRElSRUNUSVZFX0hFQURFUlM7XG4gICAgdGhpcy5jb25maWcuYWNjZXB0ZWRGaWxlcyA9IHRoaXMuYWNjZXB0ZWRGaWxlcztcbiAgICB0aGlzLmNvbmZpZy5tYXhGaWxlc2l6ZSA9IHRoaXMubWF4RmlsZXNpemU7XG4gICAgdGhpcy5jb25maWcubWF4RmlsZXMgPSB0aGlzLm1heEZpbGVzO1xuICAgIHRoaXMuY29uZmlnLnBhcmFtTmFtZSA9IHRoaXMucGFyYW1OYW1lO1xuICB9XG5cbiAgb25VcGxvYWRFcnJvcigkZXZlbnQpIHtcbiAgICAvLyBBcHBJbmplY3Rvci5nZXQoTm90aWZpY2F0aW9uU2VydmljZSkuc2hvdygnd2FybmluZycsICRldmVudFsxXSwgNTAwMCk7XG4gICAgY29uc29sZS5sb2coJ3dhcm5pbmcnLCAkZXZlbnQpO1xuICB9XG5cbiAgb25VcGxvYWRTdWNjZXNzKCRldmVudCkge1xuICAgIGlmICh0aGlzLm1heEZpbGVzICE9PSAxKSB7XG4gICAgICB0aGlzLmZpbGVMaXN0LnB1c2godGhpcy5yZXN1bHRUcmFuc2Zvcm1lcigkZXZlbnRbMV0pKTtcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmZpbGVMaXN0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy5yZXN1bHRUcmFuc2Zvcm1lcigkZXZlbnRbMV0pO1xuICAgIH1cbiAgfVxuXG4gIG9uUmVzZXQoKSB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmICYmIHRoaXMuY29tcG9uZW50UmVmLmRpcmVjdGl2ZVJlZikge1xuICAgICAgdGhpcy5jb21wb25lbnRSZWYuZGlyZWN0aXZlUmVmLnJlc2V0KCk7XG4gICAgICB0aGlzLmZpbGVMaXN0ID0gW107XG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy5maWxlTGlzdDtcbiAgICB9XG4gIH1cblxuICBvbkZpbGVSZW1vdmVkKCRldmVudCkge1xuXG4gICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZSgkZXZlbnQueGhyLnJlc3BvbnNlKTtcbiAgICBpZiAodGhpcy5tYXhGaWxlcyAhPT0gMSkge1xuICAgICAgdGhpcy5maWxlTGlzdC5zcGxpY2UodGhpcy5maWxlTGlzdC5pbmRleE9mKHRoaXMucmVzdWx0VHJhbnNmb3JtZXIob2JqKSwgMSkpO1xuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZmlsZUxpc3Q7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsdWUgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGRlbGV0ZUl0ZW0oaXRlbSkge1xuICAgIHRoaXMuZmlsZUxpc3Quc3BsaWNlKHRoaXMuZmlsZUxpc3QuaW5kZXhPZihpdGVtKSwgMSk7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuZmlsZUxpc3Q7XG4gIH1cblxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vemVmb3kvbmd4LWRyb3B6b25lLXdyYXBwZXJcbn1cbiJdfQ==