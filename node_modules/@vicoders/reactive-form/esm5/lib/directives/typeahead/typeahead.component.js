/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/typeahead/typeahead.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Injector, forwardRef, Input, ViewChild } from '@angular/core';
import { Subject, merge } from 'rxjs';
import { debounceTime, map, distinctUntilChanged, filter } from 'rxjs/operators';
import { SelectionService } from '../selection-by-api/selection-by-api';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { NgbTypeahead } from '@ng-bootstrap/ng-bootstrap';
var TypeaheadComponent = /** @class */ (function () {
    function TypeaheadComponent(api, injector) {
        var _this = this;
        this.api = api;
        this.injector = injector;
        this.focus$ = new Subject();
        this.click$ = new Subject();
        this.statesWithFlags = [];
        this.UPLOAD_DIRECTIVE_HEADERS = this.injector.get('UPLOAD_DIRECTIVE_HEADERS');
        this.UPLOAD_DIRECTIVE_API_URL = this.injector.get('UPLOAD_DIRECTIVE_API_URL');
        this.url = (/**
         * @param {?} apiUrl
         * @param {?} search
         * @return {?}
         */
        function (apiUrl, search) {
            return apiUrl + _this.apiUpload + search;
            // tslint:disable-next-line:semicolon
        });
        // search = (text$: Observable<string>) =>
        //   text$.pipe(
        //     debounceTime(200),
        //     map(term =>
        //       term === '' ? [] : this.statesWithFlags.filter(v => v[this.searchBy].toLowerCase().indexOf(term.toLowerCase()) > -1).slice(0, 10)
        //     )
        //     // tslint:disable-next-line:semicolon
        //   );
        this.search = (/**
         * @param {?} text$
         * @return {?}
         */
        function (text$) {
            /** @type {?} */
            var debouncedText$ = text$.pipe(debounceTime(200), distinctUntilChanged());
            /** @type {?} */
            var clicksWithClosedPopup$ = _this.click$.pipe(filter((/**
             * @return {?}
             */
            function () { return !_this.instance.isPopupOpen(); })));
            /** @type {?} */
            var inputFocus$ = _this.focus$;
            return merge(debouncedText$, inputFocus$, clicksWithClosedPopup$).pipe(
            // tslint:disable-next-line:max-line-length
            // map(term =>
            //   term === '' ? [] : this.statesWithFlags.filter(v => v[this.searchBy].toLowerCase().indexOf(term.toLowerCase()) > -1).slice(0, 10)
            // )
            map((/**
             * @param {?} term
             * @return {?}
             */
            function (term) {
                // tslint:disable-next-line:max-line-length
                return term === ''
                    ? _this.statesWithFlags
                    : _this.statesWithFlags.filter((/**
                     * @param {?} v
                     * @return {?}
                     */
                    function (v) { return v[_this.searchBy].toLowerCase().indexOf(term.toLowerCase()) > -1; })).slice(0, 10);
            })));
            // tslint:disable-next-line:semicolon
        });
        this.propagateChange = (/**
         * @param {?} val
         * @return {?}
         */
        function (val) { });
    }
    /**
     * @return {?}
     */
    TypeaheadComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    TypeaheadComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.isClear) {
                _this.value = null;
                _this.model = _this.value;
            }
        }), 1);
    };
    /**
     * @return {?}
     */
    TypeaheadComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var apiT = _this.url(_this.UPLOAD_DIRECTIVE_API_URL, '');
            /** @type {?} */
            var requestHeaders = _this.UPLOAD_DIRECTIVE_HEADERS;
            _this.api.getAll(apiT, requestHeaders, _this.method).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.statesWithFlags = _this.resultTransformer(response);
            }));
            if (_this.value) {
                _this.model = _this.value;
            }
        }), 1);
    };
    /**
     * @param {?} val
     * @return {?}
     */
    TypeaheadComponent.prototype.filterData = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        var _this = this;
        if (typeof val !== 'object') {
            /** @type {?} */
            var api = this.url(this.UPLOAD_DIRECTIVE_API_URL, val);
            /** @type {?} */
            var requestHeaders = this.UPLOAD_DIRECTIVE_HEADERS;
            this.api.getAll(api, requestHeaders, this.method).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.statesWithFlags = _this.resultTransformer(response);
            }));
        }
        else {
            this.value = val;
        }
    };
    Object.defineProperty(TypeaheadComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._value = val;
            this.propagateChange(this._value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    TypeaheadComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value !== undefined) {
            this.value = value;
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    TypeaheadComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.propagateChange = fn;
    };
    /**
     * @return {?}
     */
    TypeaheadComponent.prototype.registerOnTouched = /**
     * @return {?}
     */
    function () { };
    TypeaheadComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'typeahead',
                    template: "<div>\n  <ng-template #rt let-r=\"result\" let-t=\"term\">\n    <ngb-highlight *ngFor=\"let i of keyName\" [result]=\"r[i]\" [term]=\"t\"></ngb-highlight>\n  </ng-template>\n  <input\n    id=\"rf-typeahead-template-{{ id }}\"\n    type=\"text\"\n    class=\"form-control\"\n    [(ngModel)]=\"model\"\n    [ngbTypeahead]=\"search\"\n    [resultTemplate]=\"rt\"\n    [inputFormatter]=\"fieldName\"\n    (ngModelChange)=\"filterData(model)\"\n    (focus)=\"focus$.next($event.target.value)\"\n    (click)=\"click$.next($event.target.value)\"\n    #instance=\"ngbTypeahead\"\n  />\n</div>\n",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return TypeaheadComponent; })),
                            multi: true
                        },
                        SelectionService
                    ],
                    styles: ["ngb-highlight{position:relative;margin-right:15px}ngb-highlight:after{position:absolute;content:'-';top:0;right:-10px}ngb-highlight:last-child:after{position:absolute;content:''}"]
                }] }
    ];
    /** @nocollapse */
    TypeaheadComponent.ctorParameters = function () { return [
        { type: SelectionService },
        { type: Injector }
    ]; };
    TypeaheadComponent.propDecorators = {
        _value: [{ type: Input }],
        id: [{ type: Input }],
        resultTransformer: [{ type: Input }],
        apiUpload: [{ type: Input }],
        keyName: [{ type: Input }],
        method: [{ type: Input }],
        fieldName: [{ type: Input }],
        searchBy: [{ type: Input }],
        isClear: [{ type: Input }],
        instance: [{ type: ViewChild, args: ['instance', {},] }]
    };
    return TypeaheadComponent;
}());
export { TypeaheadComponent };
if (false) {
    /** @type {?} */
    TypeaheadComponent.prototype._value;
    /** @type {?} */
    TypeaheadComponent.prototype.id;
    /** @type {?} */
    TypeaheadComponent.prototype.resultTransformer;
    /** @type {?} */
    TypeaheadComponent.prototype.apiUpload;
    /** @type {?} */
    TypeaheadComponent.prototype.keyName;
    /** @type {?} */
    TypeaheadComponent.prototype.method;
    /** @type {?} */
    TypeaheadComponent.prototype.fieldName;
    /** @type {?} */
    TypeaheadComponent.prototype.searchBy;
    /** @type {?} */
    TypeaheadComponent.prototype.isClear;
    /** @type {?} */
    TypeaheadComponent.prototype.instance;
    /** @type {?} */
    TypeaheadComponent.prototype.focus$;
    /** @type {?} */
    TypeaheadComponent.prototype.click$;
    /** @type {?} */
    TypeaheadComponent.prototype.statesWithFlags;
    /** @type {?} */
    TypeaheadComponent.prototype.model;
    /** @type {?} */
    TypeaheadComponent.prototype.UPLOAD_DIRECTIVE_HEADERS;
    /** @type {?} */
    TypeaheadComponent.prototype.UPLOAD_DIRECTIVE_API_URL;
    /** @type {?} */
    TypeaheadComponent.prototype.url;
    /** @type {?} */
    TypeaheadComponent.prototype.search;
    /** @type {?} */
    TypeaheadComponent.prototype.propagateChange;
    /**
     * @type {?}
     * @private
     */
    TypeaheadComponent.prototype.api;
    /**
     * @type {?}
     * @private
     */
    TypeaheadComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZWFoZWFkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2aWNvZGVycy9yZWFjdGl2ZS1mb3JtLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvdHlwZWFoZWFkL3R5cGVhaGVhZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFFBQVEsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUE0QixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEgsT0FBTyxFQUFjLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDbEQsT0FBTyxFQUFFLFlBQVksRUFBRSxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDeEUsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMxRDtJQW1FRSw0QkFBb0IsR0FBcUIsRUFBVSxRQUFrQjtRQUFyRSxpQkFBeUU7UUFBckQsUUFBRyxHQUFILEdBQUcsQ0FBa0I7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBekNyRSxXQUFNLEdBQUcsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUMvQixXQUFNLEdBQUcsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUN4QixvQkFBZSxHQUFVLEVBQUUsQ0FBQztRQUU1Qiw2QkFBd0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQ3pFLDZCQUF3QixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDekUsUUFBRzs7Ozs7UUFBRyxVQUFDLE1BQU0sRUFBRSxNQUFNO1lBQzFCLE9B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LFFBQVE7Ozt5QkFxQmpDLEtBQUs7cUJBQ0wsS0FBSztvQ0FDTCxLQUFLOzRCQUNMLEtBQUs7MEJBQ0wsS0FBSzt5QkFDTCxLQUFLOzRCQUNMLEtBQUs7MkJBQ0wsS0FBSzswQkFDTCxLQUFLOzJCQUVMLFNBQVMsU0FBQyxVQUFVLEVBQUUsRUFBRTs7SUFxRzNCLHlCQUFDO0NBQUEsQUE5SEQsSUE4SEM7U0FoSFksa0JBQWtCOzs7SUFDN0Isb0NBQWdCOztJQUNoQixnQ0FBWTs7SUFDWiwrQ0FBMkI7O0lBQzNCLHVDQUFtQjs7SUFDbkIscUNBQWlCOztJQUNqQixvQ0FBZ0I7O0lBQ2hCLHVDQUFtQjs7SUFDbkIsc0NBQWtCOztJQUNsQixxQ0FDaUI7O0lBQ2pCLHNDQUFrRDs7SUFDbEQsb0NBQStCOztJQUMvQixvQ0FBK0I7O0lBQy9CLDZDQUFtQzs7SUFDbkMsbUNBQWtCOztJQUNsQixzREFBZ0Y7O0lBQ2hGLHNEQUFnRjs7SUFDaEYsaUNBR0U7O0lBU0Ysb0NBcUJFOztJQUdGLDZDQUFtQzs7Ozs7SUFEdkIsaUNBQTZCOzs7OztJQUFFLHNDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbmplY3RvciwgZm9yd2FyZFJlZiwgSW5wdXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBtZXJnZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBtYXAsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBTZWxlY3Rpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VsZWN0aW9uLWJ5LWFwaS9zZWxlY3Rpb24tYnktYXBpJztcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE5nYlR5cGVhaGVhZCB9IGZyb20gJ0BuZy1ib290c3RyYXAvbmctYm9vdHN0cmFwJztcbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAndHlwZWFoZWFkJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3R5cGVhaGVhZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3R5cGVhaGVhZC5jb21wb25lbnQuY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVHlwZWFoZWFkQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfSxcbiAgICBTZWxlY3Rpb25TZXJ2aWNlXG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgVHlwZWFoZWFkQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgX3ZhbHVlO1xuICBASW5wdXQoKSBpZDtcbiAgQElucHV0KCkgcmVzdWx0VHJhbnNmb3JtZXI7XG4gIEBJbnB1dCgpIGFwaVVwbG9hZDtcbiAgQElucHV0KCkga2V5TmFtZTtcbiAgQElucHV0KCkgbWV0aG9kO1xuICBASW5wdXQoKSBmaWVsZE5hbWU7XG4gIEBJbnB1dCgpIHNlYXJjaEJ5O1xuICBASW5wdXQoKVxuICBpc0NsZWFyOiBCb29sZWFuO1xuICBAVmlld0NoaWxkKCdpbnN0YW5jZScsIHt9KSBpbnN0YW5jZTogTmdiVHlwZWFoZWFkO1xuICBmb2N1cyQgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG4gIGNsaWNrJCA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcbiAgcHVibGljIHN0YXRlc1dpdGhGbGFnczogYW55W10gPSBbXTtcbiAgcHVibGljIG1vZGVsOiBhbnk7XG4gIHB1YmxpYyBVUExPQURfRElSRUNUSVZFX0hFQURFUlMgPSB0aGlzLmluamVjdG9yLmdldCgnVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTJyk7XG4gIHB1YmxpYyBVUExPQURfRElSRUNUSVZFX0FQSV9VUkwgPSB0aGlzLmluamVjdG9yLmdldCgnVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMJyk7XG4gIHB1YmxpYyB1cmwgPSAoYXBpVXJsLCBzZWFyY2gpID0+IHtcbiAgICByZXR1cm4gYXBpVXJsICsgdGhpcy5hcGlVcGxvYWQgKyBzZWFyY2g7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnNlbWljb2xvblxuICB9O1xuICAvLyBzZWFyY2ggPSAodGV4dCQ6IE9ic2VydmFibGU8c3RyaW5nPikgPT5cbiAgLy8gICB0ZXh0JC5waXBlKFxuICAvLyAgICAgZGVib3VuY2VUaW1lKDIwMCksXG4gIC8vICAgICBtYXAodGVybSA9PlxuICAvLyAgICAgICB0ZXJtID09PSAnJyA/IFtdIDogdGhpcy5zdGF0ZXNXaXRoRmxhZ3MuZmlsdGVyKHYgPT4gdlt0aGlzLnNlYXJjaEJ5XS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGVybS50b0xvd2VyQ2FzZSgpKSA+IC0xKS5zbGljZSgwLCAxMClcbiAgLy8gICAgIClcbiAgLy8gICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpzZW1pY29sb25cbiAgLy8gICApO1xuICBzZWFyY2ggPSAodGV4dCQ6IE9ic2VydmFibGU8c3RyaW5nPikgPT4ge1xuICAgIGNvbnN0IGRlYm91bmNlZFRleHQkID0gdGV4dCQucGlwZShcbiAgICAgIGRlYm91bmNlVGltZSgyMDApLFxuICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxuICAgICk7XG4gICAgY29uc3QgY2xpY2tzV2l0aENsb3NlZFBvcHVwJCA9IHRoaXMuY2xpY2skLnBpcGUoZmlsdGVyKCgpID0+ICF0aGlzLmluc3RhbmNlLmlzUG9wdXBPcGVuKCkpKTtcbiAgICBjb25zdCBpbnB1dEZvY3VzJCA9IHRoaXMuZm9jdXMkO1xuXG4gICAgcmV0dXJuIG1lcmdlKGRlYm91bmNlZFRleHQkLCBpbnB1dEZvY3VzJCwgY2xpY2tzV2l0aENsb3NlZFBvcHVwJCkucGlwZShcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICAgIC8vIG1hcCh0ZXJtID0+XG4gICAgICAvLyAgIHRlcm0gPT09ICcnID8gW10gOiB0aGlzLnN0YXRlc1dpdGhGbGFncy5maWx0ZXIodiA9PiB2W3RoaXMuc2VhcmNoQnldLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtLnRvTG93ZXJDYXNlKCkpID4gLTEpLnNsaWNlKDAsIDEwKVxuICAgICAgLy8gKVxuICAgICAgbWFwKHRlcm0gPT5cbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgICB0ZXJtID09PSAnJ1xuICAgICAgICAgID8gdGhpcy5zdGF0ZXNXaXRoRmxhZ3NcbiAgICAgICAgICA6IHRoaXMuc3RhdGVzV2l0aEZsYWdzLmZpbHRlcih2ID0+IHZbdGhpcy5zZWFyY2hCeV0udG9Mb3dlckNhc2UoKS5pbmRleE9mKHRlcm0udG9Mb3dlckNhc2UoKSkgPiAtMSkuc2xpY2UoMCwgMTApXG4gICAgICApXG4gICAgKTtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6c2VtaWNvbG9uXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGk6IFNlbGVjdGlvblNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7fVxuICBwcm9wYWdhdGVDaGFuZ2UgPSAodmFsOiBhbnkpID0+IHt9O1xuXG4gIG5nT25Jbml0KCkge31cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmlzQ2xlYXIpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG4gICAgICAgIHRoaXMubW9kZWwgPSB0aGlzLnZhbHVlO1xuICAgICAgfVxuICAgIH0sIDEpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgYXBpVCA9IHRoaXMudXJsKHRoaXMuVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMLCAnJyk7XG4gICAgICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IHRoaXMuVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTO1xuICAgICAgdGhpcy5hcGkuZ2V0QWxsKGFwaVQsIHJlcXVlc3RIZWFkZXJzLCB0aGlzLm1ldGhvZCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgdGhpcy5zdGF0ZXNXaXRoRmxhZ3MgPSB0aGlzLnJlc3VsdFRyYW5zZm9ybWVyKHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHRoaXMudmFsdWUpIHtcbiAgICAgICAgdGhpcy5tb2RlbCA9IHRoaXMudmFsdWU7XG4gICAgICB9XG4gICAgfSwgMSk7XG4gIH1cblxuICBmaWx0ZXJEYXRhKHZhbCkge1xuICAgIGlmICh0eXBlb2YgdmFsICE9PSAnb2JqZWN0Jykge1xuICAgICAgY29uc3QgYXBpID0gdGhpcy51cmwodGhpcy5VUExPQURfRElSRUNUSVZFX0FQSV9VUkwsIHZhbCk7XG4gICAgICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IHRoaXMuVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTO1xuICAgICAgdGhpcy5hcGkuZ2V0QWxsKGFwaSwgcmVxdWVzdEhlYWRlcnMsIHRoaXMubWV0aG9kKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlc1dpdGhGbGFncyA9IHRoaXMucmVzdWx0VHJhbnNmb3JtZXIocmVzcG9uc2UpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWw7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIHNldCB2YWx1ZSh2YWwpIHtcbiAgICB0aGlzLl92YWx1ZSA9IHZhbDtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSh0aGlzLl92YWx1ZSk7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm4pIHtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoKSB7fVxufVxuXG4vLyBodHRwczovL25nLWJvb3RzdHJhcC5naXRodWIuaW8vIy9jb21wb25lbnRzL3R5cGVhaGVhZC9leGFtcGxlc1xuIl19