/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/selection-by-api/selection-by-api.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, forwardRef, Injector } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { SelectionService } from './selection-by-api';
import * as _ from 'lodash';
var SelectionByApiComponent = /** @class */ (function () {
    function SelectionByApiComponent(api, injector) {
        var _this = this;
        this.api = api;
        this.injector = injector;
        this.isShow = false;
        this.isSearching = false;
        this.UPLOAD_DIRECTIVE_HEADERS = this.injector.get('UPLOAD_DIRECTIVE_HEADERS');
        this.UPLOAD_DIRECTIVE_API_URL = this.injector.get('UPLOAD_DIRECTIVE_API_URL');
        this.KEY_CODE = {
            UP_ARROW: 38,
            DOWN_ARROW: 40
        };
        this.url = (/**
         * @param {?} apiUrl
         * @param {?} search
         * @return {?}
         */
        function (apiUrl, search) {
            return apiUrl + _this.apiUpload + search;
            // tslint:disable-next-line:semicolon
        });
        this.propagateChange = (/**
         * @param {?} val
         * @return {?}
         */
        function (val) { });
    }
    /**
     * @return {?}
     */
    SelectionByApiComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var $this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            $('body').click((/**
             * @return {?}
             */
            function () {
                if (event.target !== document.getElementById('search-single-selection-reative-form-' + this.id)) {
                    $this.isShow = false;
                }
            }));
            if (_this.value) {
                _this.text = _this.fieldName(_this.value);
                /** @type {?} */
                var api = _this.url(_this.UPLOAD_DIRECTIVE_API_URL, _this.fieldName(_this.value));
                /** @type {?} */
                var requestHeaders = _this.UPLOAD_DIRECTIVE_HEADERS;
                _this.api.getAll(api, requestHeaders, _this.method).subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                function (response) {
                    _this.options = _this.resultTransformer(response);
                    _this.addSelected();
                }));
            }
        }), 1);
    };
    /**
     * @return {?}
     */
    SelectionByApiComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.isClear === true) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.value = null;
                _this.text = null;
            }), 1);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SelectionByApiComponent.prototype.filterData = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        document.getElementById('search-single-selection-reative-form-' + this.id).setAttribute('disabled', 'true');
        this.options = [];
        if (event.length <= 0) {
            this.value = null;
            this.options = [];
            document.getElementById('search-single-selection-reative-form-' + this.id).removeAttribute('disabled');
            document.getElementById('search-single-selection-reative-form-' + this.id).focus();
        }
        if (event.length >= this.lengthToSearch) {
            this.isSearching = true;
            this.isShow = true;
            this.value = null;
            /** @type {?} */
            var api = this.url(this.UPLOAD_DIRECTIVE_API_URL, event);
            /** @type {?} */
            var requestHeaders = this.UPLOAD_DIRECTIVE_HEADERS;
            this.api.getAll(api, requestHeaders, this.method).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.options = _this.resultTransformer(response);
                _this.isSearching = false;
                document.getElementById('search-single-selection-reative-form-' + _this.id).removeAttribute('disabled');
                document.getElementById('search-single-selection-reative-form-' + _this.id).focus();
            }));
        }
    };
    /**
     * @return {?}
     */
    SelectionByApiComponent.prototype.addSelected = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var $this = this;
        _.map(this.options, (/**
         * @param {?} item
         * @param {?} key
         * @return {?}
         */
        function (item, key) {
            delete item.selected;
            if (_.isEqual(item, $this.value)) {
                _.assign(item, { selected: true });
            }
        }));
    };
    /**
     * @param {?} item
     * @return {?}
     */
    SelectionByApiComponent.prototype.detailClick = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.setValue(item);
        this.isShow = false;
    };
    /**
     * @return {?}
     */
    SelectionByApiComponent.prototype.changeStatusOptions = /**
     * @return {?}
     */
    function () {
        this.isShow === false ? (this.isShow = true) : (this.isShow = false);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SelectionByApiComponent.prototype.onKeydown = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (event.keyCode === this.KEY_CODE.DOWN_ARROW && this.isShow) {
            _.forEach(this.options, (/**
             * @param {?} i
             * @return {?}
             */
            function (i) { return delete i.selected; }));
            if (this.value) {
                /** @type {?} */
                var current_item = _.find(this.options, (/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return _this.fieldName(i) === _this.fieldName(_this.value); }));
                if (current_item) {
                    /** @type {?} */
                    var index_current_item = this.options.indexOf(current_item);
                    /** @type {?} */
                    var last_item = this.options.slice(-1).pop();
                    /** @type {?} */
                    var index_last_item = this.options.indexOf(last_item);
                    if (index_current_item === index_last_item) {
                        this.value = this.options[0];
                    }
                    else {
                        this.value = this.options[index_current_item + 1];
                    }
                }
                else {
                    this.value = this.options[0];
                }
            }
            else {
                this.value = this.options[0];
            }
            this.setValue(this.value);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SelectionByApiComponent.prototype.onKeyup = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (event.keyCode === this.KEY_CODE.UP_ARROW && this.isShow) {
            _.forEach(this.options, (/**
             * @param {?} i
             * @return {?}
             */
            function (i) { return delete i.selected; }));
            if (this.value) {
                /** @type {?} */
                var current_item = _.find(this.options, (/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return _this.fieldName(i) === _this.fieldName(_this.value); }));
                if (current_item) {
                    /** @type {?} */
                    var index_current_item = this.options.indexOf(current_item);
                    /** @type {?} */
                    var head_item = this.options[0];
                    /** @type {?} */
                    var index_head_item = this.options.indexOf(head_item);
                    if (index_current_item === index_head_item) {
                        this.value = this.options.slice(-1).pop();
                    }
                    else {
                        this.value = this.options[index_current_item - 1];
                    }
                }
                else {
                    this.value = this.options.slice(-1).pop();
                }
            }
            else {
                this.value = this.options.slice(-1).pop();
            }
            this.setValue(this.value);
        }
    };
    /**
     * @param {?} array
     * @return {?}
     */
    SelectionByApiComponent.prototype._isEmpty = /**
     * @param {?} array
     * @return {?}
     */
    function (array) {
        return _.isEmpty(array) ? true : false;
    };
    /**
     * @param {?} item
     * @return {?}
     */
    SelectionByApiComponent.prototype.setValue = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.text = this.fieldName(item);
        this.value = item;
        this.addSelected();
    };
    Object.defineProperty(SelectionByApiComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._value = val;
            this.propagateChange(this._value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    SelectionByApiComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value !== undefined) {
            this.value = value;
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SelectionByApiComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.propagateChange = fn;
    };
    /**
     * @return {?}
     */
    SelectionByApiComponent.prototype.registerOnTouched = /**
     * @return {?}
     */
    function () { };
    SelectionByApiComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'selection-by-api',
                    template: "<div class=\"form-group selection-group\">\n  <input\n    autocomplete=\"off\"\n    id=\"search-single-selection-reative-form-{{ id }}\"\n    class=\"form-control search-text\"\n    (click)=\"changeStatusOptions()\"\n    type=\"text\"\n    name=\"search\"\n    #search\n    [(ngModel)]=\"text\"\n    (ngModelChange)=\"filterData(search.value)\"\n    (keydown)=\"onKeydown($event)\"\n    (keyup)=\"onKeyup($event)\"\n  />\n\n  <div *ngIf=\"!_isEmpty(options) && isShow\" class=\"scrollbar\" id=\"style-default\">\n    <div class=\"force-overflow\">\n      <p\n        class=\"rAtF_sBA_options__item\"\n        *ngFor=\"let item of options\"\n        [ngClass]=\"{ 'selection-by-api__selected': item.selected }\"\n        (click)=\"detailClick(item)\"\n      >\n        {{ fieldName(item) }}\n      </p>\n    </div>\n  </div>\n  <div *ngIf=\"_isEmpty(options) && isShow && !isSearching\" class=\"options-group\">\n    <p>Resource not found</p>\n  </div>\n  <div *ngIf=\"isShow && isSearching\" class=\"options-group\">\n    <p>Searching...</p>\n  </div>\n</div>\n",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return SelectionByApiComponent; })),
                            multi: true
                        },
                        SelectionService
                    ],
                    styles: [".selection-group{position:relative}.options-group{position:absolute;border:1px solid #d3d3d3;border-radius:5px;width:100%;z-index:9;background-color:#fff;border-top:none}.options-group p,.scrollbar p{cursor:pointer;padding:.375rem .75rem;margin:0}.options-group p:focus,.options-group p:hover,.rAtF_sBA_options__item:focus,.scrollbar p:focus,.scrollbar p:hover,.selection-by-api__selected{background-color:#6495ed;color:#fff}.scrollbar{position:absolute;max-height:200px;background:#fff;overflow-y:scroll;border:1px solid #d3d3d3;border-radius:5px;width:100%;z-index:9;border-top:none}.force-overflow{max-height:200px}"]
                }] }
    ];
    /** @nocollapse */
    SelectionByApiComponent.ctorParameters = function () { return [
        { type: SelectionService },
        { type: Injector }
    ]; };
    SelectionByApiComponent.propDecorators = {
        _value: [{ type: Input }],
        resultTransformer: [{ type: Input }],
        apiUpload: [{ type: Input }],
        headers: [{ type: Input }],
        fieldName: [{ type: Input }],
        lengthToSearch: [{ type: Input }],
        isClear: [{ type: Input }],
        method: [{ type: Input }],
        id: [{ type: Input }]
    };
    return SelectionByApiComponent;
}());
export { SelectionByApiComponent };
if (false) {
    /** @type {?} */
    SelectionByApiComponent.prototype._value;
    /** @type {?} */
    SelectionByApiComponent.prototype.resultTransformer;
    /** @type {?} */
    SelectionByApiComponent.prototype.apiUpload;
    /** @type {?} */
    SelectionByApiComponent.prototype.headers;
    /** @type {?} */
    SelectionByApiComponent.prototype.fieldName;
    /** @type {?} */
    SelectionByApiComponent.prototype.lengthToSearch;
    /** @type {?} */
    SelectionByApiComponent.prototype.isClear;
    /** @type {?} */
    SelectionByApiComponent.prototype.method;
    /** @type {?} */
    SelectionByApiComponent.prototype.id;
    /** @type {?} */
    SelectionByApiComponent.prototype.text;
    /** @type {?} */
    SelectionByApiComponent.prototype.options;
    /** @type {?} */
    SelectionByApiComponent.prototype.isShow;
    /** @type {?} */
    SelectionByApiComponent.prototype.isSearching;
    /** @type {?} */
    SelectionByApiComponent.prototype.UPLOAD_DIRECTIVE_HEADERS;
    /** @type {?} */
    SelectionByApiComponent.prototype.UPLOAD_DIRECTIVE_API_URL;
    /** @type {?} */
    SelectionByApiComponent.prototype.KEY_CODE;
    /** @type {?} */
    SelectionByApiComponent.prototype.url;
    /** @type {?} */
    SelectionByApiComponent.prototype.propagateChange;
    /**
     * @type {?}
     * @private
     */
    SelectionByApiComponent.prototype.api;
    /**
     * @type {?}
     * @private
     */
    SelectionByApiComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0aW9uLWJ5LWFwaS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Admljb2RlcnMvcmVhY3RpdmUtZm9ybS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL3NlbGVjdGlvbi1ieS1hcGkvc2VsZWN0aW9uLWJ5LWFwaS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxVQUFVLEVBSVYsUUFBUSxFQUlULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUN0RCxPQUFPLEtBQUssQ0FBQyxNQUFNLFFBQVEsQ0FBQztBQUc1QjtJQXNDRSxpQ0FBb0IsR0FBcUIsRUFBVSxRQUFrQjtRQUFyRSxpQkFBeUU7UUFBckQsUUFBRyxHQUFILEdBQUcsQ0FBa0I7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBWjlELFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQiw2QkFBd0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQ3pFLDZCQUF3QixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDekUsYUFBUSxHQUFHO1lBQ2hCLFFBQVEsRUFBRSxFQUFFO1lBQ1osVUFBVSxFQUFFLEVBQUU7U0FDZixDQUFDO1FBQ0ssUUFBRzs7Ozs7UUFBRyxVQUFDLE1BQU0sRUFBRSxNQUFNO1lBQzFCLE9BQU8sTUFBTSxHQUFHLEtBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO1lBQ3hDLHFDQUFxQztRQUN2QyxDQUFDLEVBQUM7UUFFRixvQkFBZTs7OztRQUFHLFVBQUMsR0FBUSxJQUFN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RTs7SUFFRixrREFBbUM7Ozs7O0lBRHZCLHNDQUE2Qjs7Ozs7SUFBRSwyQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIE9uSW5pdCxcbiAgSW5wdXQsXG4gIGZvcndhcmRSZWYsXG4gIEFmdGVyVmlld0luaXQsXG4gIEluamVjdCxcbiAgT25DaGFuZ2VzLFxuICBJbmplY3RvcixcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBIb3N0TGlzdGVuZXJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTZWxlY3Rpb25TZXJ2aWNlIH0gZnJvbSAnLi9zZWxlY3Rpb24tYnktYXBpJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmRlY2xhcmUgY29uc3QgJDogYW55O1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ3NlbGVjdGlvbi1ieS1hcGknLFxuICB0ZW1wbGF0ZVVybDogJy4vc2VsZWN0aW9uLWJ5LWFwaS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3NlbGVjdGlvbi1ieS1hcGkuY29tcG9uZW50LmNzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFNlbGVjdGlvbkJ5QXBpQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfSxcbiAgICBTZWxlY3Rpb25TZXJ2aWNlXG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgU2VsZWN0aW9uQnlBcGlDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcbiAgQElucHV0KCkgX3ZhbHVlO1xuICBASW5wdXQoKSByZXN1bHRUcmFuc2Zvcm1lcjtcbiAgQElucHV0KCkgYXBpVXBsb2FkO1xuICBASW5wdXQoKSBoZWFkZXJzO1xuICBASW5wdXQoKSBmaWVsZE5hbWU7XG4gIEBJbnB1dCgpIGxlbmd0aFRvU2VhcmNoO1xuICBASW5wdXQoKSBpc0NsZWFyOiBCb29sZWFuO1xuICBASW5wdXQoKSBtZXRob2Q7XG4gIEBJbnB1dCgpIGlkO1xuICBwdWJsaWMgdGV4dDtcbiAgcHVibGljIG9wdGlvbnM7XG4gIHB1YmxpYyBpc1Nob3cgPSBmYWxzZTtcbiAgcHVibGljIGlzU2VhcmNoaW5nID0gZmFsc2U7XG4gIHB1YmxpYyBVUExPQURfRElSRUNUSVZFX0hFQURFUlMgPSB0aGlzLmluamVjdG9yLmdldCgnVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTJyk7XG4gIHB1YmxpYyBVUExPQURfRElSRUNUSVZFX0FQSV9VUkwgPSB0aGlzLmluamVjdG9yLmdldCgnVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMJyk7XG4gIHB1YmxpYyBLRVlfQ09ERSA9IHtcbiAgICBVUF9BUlJPVzogMzgsXG4gICAgRE9XTl9BUlJPVzogNDBcbiAgfTtcbiAgcHVibGljIHVybCA9IChhcGlVcmwsIHNlYXJjaCkgPT4ge1xuICAgIHJldHVybiBhcGlVcmwgKyB0aGlzLmFwaVVwbG9hZCArIHNlYXJjaDtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6c2VtaWNvbG9uXG4gIH07XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBpOiBTZWxlY3Rpb25TZXJ2aWNlLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge31cbiAgcHJvcGFnYXRlQ2hhbmdlID0gKHZhbDogYW55KSA9PiB7fTtcblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgJHRoaXMgPSB0aGlzO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgJCgnYm9keScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoLXNpbmdsZS1zZWxlY3Rpb24tcmVhdGl2ZS1mb3JtLScgKyB0aGlzLmlkKSkge1xuICAgICAgICAgICR0aGlzLmlzU2hvdyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLnZhbHVlKSB7XG4gICAgICAgIHRoaXMudGV4dCA9IHRoaXMuZmllbGROYW1lKHRoaXMudmFsdWUpO1xuICAgICAgICBjb25zdCBhcGkgPSB0aGlzLnVybCh0aGlzLlVQTE9BRF9ESVJFQ1RJVkVfQVBJX1VSTCwgdGhpcy5maWVsZE5hbWUodGhpcy52YWx1ZSkpO1xuICAgICAgICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IHRoaXMuVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTO1xuICAgICAgICB0aGlzLmFwaS5nZXRBbGwoYXBpLCByZXF1ZXN0SGVhZGVycywgdGhpcy5tZXRob2QpLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5yZXN1bHRUcmFuc2Zvcm1lcihyZXNwb25zZSk7XG4gICAgICAgICAgdGhpcy5hZGRTZWxlY3RlZCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LCAxKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIGlmICh0aGlzLmlzQ2xlYXIgPT09IHRydWUpIHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnZhbHVlID0gbnVsbDtcbiAgICAgICAgdGhpcy50ZXh0ID0gbnVsbDtcbiAgICAgIH0sIDEpO1xuICAgIH1cbiAgfVxuXG4gIGZpbHRlckRhdGEoZXZlbnQpOiB2b2lkIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoLXNpbmdsZS1zZWxlY3Rpb24tcmVhdGl2ZS1mb3JtLScgKyB0aGlzLmlkKS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ3RydWUnKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBbXTtcbiAgICBpZiAoZXZlbnQubGVuZ3RoIDw9IDApIHtcbiAgICAgIHRoaXMudmFsdWUgPSBudWxsO1xuICAgICAgdGhpcy5vcHRpb25zID0gW107XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoLXNpbmdsZS1zZWxlY3Rpb24tcmVhdGl2ZS1mb3JtLScgKyB0aGlzLmlkKS5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoLXNpbmdsZS1zZWxlY3Rpb24tcmVhdGl2ZS1mb3JtLScgKyB0aGlzLmlkKS5mb2N1cygpO1xuICAgIH1cbiAgICBpZiAoZXZlbnQubGVuZ3RoID49IHRoaXMubGVuZ3RoVG9TZWFyY2gpIHtcbiAgICAgIHRoaXMuaXNTZWFyY2hpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5pc1Nob3cgPSB0cnVlO1xuICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG4gICAgICBjb25zdCBhcGkgPSB0aGlzLnVybCh0aGlzLlVQTE9BRF9ESVJFQ1RJVkVfQVBJX1VSTCwgZXZlbnQpO1xuICAgICAgY29uc3QgcmVxdWVzdEhlYWRlcnMgPSB0aGlzLlVQTE9BRF9ESVJFQ1RJVkVfSEVBREVSUztcbiAgICAgIHRoaXMuYXBpLmdldEFsbChhcGksIHJlcXVlc3RIZWFkZXJzLCB0aGlzLm1ldGhvZCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5yZXN1bHRUcmFuc2Zvcm1lcihyZXNwb25zZSk7XG4gICAgICAgIHRoaXMuaXNTZWFyY2hpbmcgPSBmYWxzZTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaC1zaW5nbGUtc2VsZWN0aW9uLXJlYXRpdmUtZm9ybS0nICsgdGhpcy5pZCkucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoLXNpbmdsZS1zZWxlY3Rpb24tcmVhdGl2ZS1mb3JtLScgKyB0aGlzLmlkKS5mb2N1cygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYWRkU2VsZWN0ZWQoKSB7XG4gICAgY29uc3QgJHRoaXMgPSB0aGlzO1xuICAgIF8ubWFwKHRoaXMub3B0aW9ucywgKGl0ZW0sIGtleSkgPT4ge1xuICAgICAgZGVsZXRlIGl0ZW0uc2VsZWN0ZWQ7XG4gICAgICBpZiAoXy5pc0VxdWFsKGl0ZW0sICR0aGlzLnZhbHVlKSkge1xuICAgICAgICBfLmFzc2lnbihpdGVtLCB7IHNlbGVjdGVkOiB0cnVlIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZGV0YWlsQ2xpY2soaXRlbSkge1xuICAgIHRoaXMuc2V0VmFsdWUoaXRlbSk7XG4gICAgdGhpcy5pc1Nob3cgPSBmYWxzZTtcbiAgfVxuXG4gIGNoYW5nZVN0YXR1c09wdGlvbnMoKSB7XG4gICAgdGhpcy5pc1Nob3cgPT09IGZhbHNlID8gKHRoaXMuaXNTaG93ID0gdHJ1ZSkgOiAodGhpcy5pc1Nob3cgPSBmYWxzZSk7XG4gIH1cblxuICBvbktleWRvd24oZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gdGhpcy5LRVlfQ09ERS5ET1dOX0FSUk9XICYmIHRoaXMuaXNTaG93KSB7XG4gICAgICBfLmZvckVhY2godGhpcy5vcHRpb25zLCBpID0+IGRlbGV0ZSBpLnNlbGVjdGVkKTtcbiAgICAgIGlmICh0aGlzLnZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRfaXRlbSA9IF8uZmluZCh0aGlzLm9wdGlvbnMsIGkgPT4gdGhpcy5maWVsZE5hbWUoaSkgPT09IHRoaXMuZmllbGROYW1lKHRoaXMudmFsdWUpKTtcbiAgICAgICAgaWYgKGN1cnJlbnRfaXRlbSkge1xuICAgICAgICAgIGNvbnN0IGluZGV4X2N1cnJlbnRfaXRlbSA9IHRoaXMub3B0aW9ucy5pbmRleE9mKGN1cnJlbnRfaXRlbSk7XG4gICAgICAgICAgY29uc3QgbGFzdF9pdGVtID0gdGhpcy5vcHRpb25zLnNsaWNlKC0xKS5wb3AoKTtcbiAgICAgICAgICBjb25zdCBpbmRleF9sYXN0X2l0ZW0gPSB0aGlzLm9wdGlvbnMuaW5kZXhPZihsYXN0X2l0ZW0pO1xuICAgICAgICAgIGlmIChpbmRleF9jdXJyZW50X2l0ZW0gPT09IGluZGV4X2xhc3RfaXRlbSkge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9uc1swXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9uc1tpbmRleF9jdXJyZW50X2l0ZW0gKyAxXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9uc1swXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9uc1swXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0VmFsdWUodGhpcy52YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgb25LZXl1cChldmVudCkge1xuICAgIGlmIChldmVudC5rZXlDb2RlID09PSB0aGlzLktFWV9DT0RFLlVQX0FSUk9XICYmIHRoaXMuaXNTaG93KSB7XG4gICAgICBfLmZvckVhY2godGhpcy5vcHRpb25zLCBpID0+IGRlbGV0ZSBpLnNlbGVjdGVkKTtcbiAgICAgIGlmICh0aGlzLnZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRfaXRlbSA9IF8uZmluZCh0aGlzLm9wdGlvbnMsIGkgPT4gdGhpcy5maWVsZE5hbWUoaSkgPT09IHRoaXMuZmllbGROYW1lKHRoaXMudmFsdWUpKTtcbiAgICAgICAgaWYgKGN1cnJlbnRfaXRlbSkge1xuICAgICAgICAgIGNvbnN0IGluZGV4X2N1cnJlbnRfaXRlbSA9IHRoaXMub3B0aW9ucy5pbmRleE9mKGN1cnJlbnRfaXRlbSk7XG4gICAgICAgICAgY29uc3QgaGVhZF9pdGVtID0gdGhpcy5vcHRpb25zWzBdO1xuICAgICAgICAgIGNvbnN0IGluZGV4X2hlYWRfaXRlbSA9IHRoaXMub3B0aW9ucy5pbmRleE9mKGhlYWRfaXRlbSk7XG4gICAgICAgICAgaWYgKGluZGV4X2N1cnJlbnRfaXRlbSA9PT0gaW5kZXhfaGVhZF9pdGVtKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vcHRpb25zLnNsaWNlKC0xKS5wb3AoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9uc1tpbmRleF9jdXJyZW50X2l0ZW0gLSAxXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub3B0aW9ucy5zbGljZSgtMSkucG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLm9wdGlvbnMuc2xpY2UoLTEpLnBvcCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRWYWx1ZSh0aGlzLnZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBfaXNFbXB0eShhcnJheSkge1xuICAgIHJldHVybiBfLmlzRW1wdHkoYXJyYXkpID8gdHJ1ZSA6IGZhbHNlO1xuICB9XG5cbiAgc2V0VmFsdWUoaXRlbSkge1xuICAgIHRoaXMudGV4dCA9IHRoaXMuZmllbGROYW1lKGl0ZW0pO1xuICAgIHRoaXMudmFsdWUgPSBpdGVtO1xuICAgIHRoaXMuYWRkU2VsZWN0ZWQoKTtcbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBzZXQgdmFsdWUodmFsKSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWw7XG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodGhpcy5fdmFsdWUpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuKSB7XG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKCkge31cbn1cbiJdfQ==